<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A.S.T.R.A Chat</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

   <!-- Options button -->
<button id="option-btn" 
        style="position: fixed; top: 20px; left: 20px; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; z-index:1001;">
  ‚öôÔ∏è Options
</button>

<!-- Options Menu -->
<div id="option-menu" 
     style="position: fixed; top: 60px; left: 20px; background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 10px; display: none; z-index:1001; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: fit-content; min-width: max-content;">

  <!-- Dark Mode Toggle -->
  <button id="dark-toggle" 
          style="padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; margin-bottom:10px; display:block; width:100%;">
    üåô Dark Mode
  </button>

  <!-- Notes button -->
  <button id="notes-btn"
          style="padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; display:block; width:100%; margin-bottom:5px;">
    üìí Notes
  </button>

  <!-- Calendar button -->
  <button id="calendar-btn"
          style="padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; display:block; width:100%;">
    üìÖ Calendar
  </button>

  <!-- View All Events button -->
  <button id="view-events-btn"
          style="padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; display:block; width:100%; margin-top:5px;">
    üìã View All Events
  </button>

</div>

<!-- Notes Panel -->
<div id="notes-panel" 
     style="display:none; position: fixed; right: 20px; top: 80px; width: 250px; height: 300px; background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 10px; z-index:1002; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex-direction:column;">

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <h4 style="margin:0;">üìí Notes</h4>
    <div>
      <button id="fullscreen-notes" 
              style="background:none; border:none; font-size:16px; cursor:pointer; margin-right:5px;" 
              title="Fullscreen">‚õ∂</button>
      <button id="close-notes" 
              style="background:none; border:none; font-size:16px; cursor:pointer;">‚ùå</button>
    </div>
  </div>

  <!-- textarea halos lahat ng space -->
  <textarea id="notes-input" 
            style="flex-grow:1; width:100%; resize:none; padding:8px; border-radius:6px; border:1px solid #ccc; margin-bottom:8px;"></textarea>
  
  <!-- Buttons row -->
  <div style="display:flex; gap:8px; justify-content:space-between; margin-top:10px;">
    <button id="back-notes" 
            style="padding:6px 12px; border:none; border-radius:6px; cursor:pointer;">
      ‚¨ÖÔ∏è Back
    </button>

    <button id="save-notes" 
            style="padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:#4CAF50; color:white;">
      üíæ Save
    </button>

    <button id="next-notes" 
            style="padding:6px 12px; border:none; border-radius:6px; cursor:pointer;">
      Next ‚û°Ô∏è
    </button>
  </div>

</div>

<!-- Full Calendar Panel -->
<div id="calendar-panel" style="display:none; position: fixed; right: 20px; top: 80px; width: 350px; height: 400px; background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 10px; z-index:1002; box-shadow:0 4px 12px rgba(0,0,0,0.1); flex-direction:column;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <h4>üìÖ Calendar</h4>
    <button id="close-calendar" style="background:none; border:none; font-size:16px; cursor:pointer;">‚ùå</button>
  </div>

  <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
    <button id="prev-month">‚¨ÖÔ∏è</button>
    <span id="month-year"></span>
    <button id="next-month">‚û°Ô∏è</button>
  </div>

  <div id="calendar-grid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:2px; text-align:center;"></div>

  <input type="text" id="event-text" placeholder="Event description" style="width:100%; margin-top:5px; padding:5px;">
  <button id="add-calendar-event" style="width:100%; margin-top:5px;">‚ûï Add Event</button>
</div>

<!-- All Events Panel -->
<div id="all-events-panel" 
     style="display:none; position: fixed; right: 20px; top: 80px; width: 350px; max-height: 400px; background: #fff; border-radius: 12px; padding: 15px; z-index:1002; box-shadow:0 8px 24px rgba(0,0,0,0.2); overflow-y:auto; font-family: 'Inter', sans-serif; flex-direction:column;">

  <!-- Header (Title + Close button) -->
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
    <h4 style="margin:0; font-weight:600;">üìã All Events</h4>
    <button id="close-events" style="background:none; border:none; font-size:18px; cursor:pointer;">‚ùå</button>
  </div>

  <!-- Events List -->
  <div id="events-list" style="display:flex; flex-direction:column; gap:10px;"></div>
</div>

</div>

<div id="chat-container">
  <div id="welcome-message">Hi there! How‚Äôs your day going? How can I assist you today?</div>
  <div id="conversation"></div>
</div>

<div id="input-bar">
  <textarea id="user-input" placeholder="Type your question..." inputmode="text" enterkeyhint="newline"></textarea>
  <button id="send-btn">Send</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ================= Elements =================
  const welcomeMessage = document.getElementById('welcome-message');
  const conversation = document.getElementById('conversation');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const darkToggle = document.getElementById('dark-toggle');
  const optionBtn = document.getElementById('option-btn');
  const optionMenu = document.getElementById('option-menu');
  const notesBtn = document.getElementById('notes-btn');
  const notesPanel = document.getElementById('notes-panel');
  const closeNotes = document.getElementById('close-notes');
  const calendarBtn = document.getElementById('calendar-btn');
  const calendarPanel = document.getElementById('calendar-panel');
  const closeCalendar = document.getElementById('close-calendar');
  const saveNotes = document.getElementById('save-notes');
  const notesInput = document.getElementById('notes-input');
  const nextNotes = document.getElementById('next-notes');
  const backNotes = document.getElementById('back-notes');
  const addCalendarEventBtn = document.getElementById('add-calendar-event');
  const eventTextInput = document.getElementById('event-text');
  const monthYearLabel = document.getElementById('month-year');
  const calendarGrid = document.getElementById('calendar-grid');
  const prevMonthBtn = document.getElementById('prev-month');
  const nextMonthBtn = document.getElementById('next-month');
  const viewEventsBtn = document.getElementById('view-events-btn');
  const allEventsPanel = document.getElementById('all-events-panel');
  const eventsList = document.getElementById('events-list');
  const closeEvents = document.getElementById('close-events');
  const fullScreenNotesBtn = document.getElementById('fullscreen-notes');

  // ================= Notes Setup =================
  const pageIndicator = document.createElement("div");
  pageIndicator.id = "page-indicator";
  pageIndicator.style.textAlign = "center";
  pageIndicator.style.marginTop = "8px";
  notesPanel.appendChild(pageIndicator);

  let currentPage = 0;
  const totalPages = 10;
  function updateIndicator() {
    pageIndicator.textContent = `Page ${currentPage + 1} / ${totalPages}`;
  }
  function loadNotes(page) {
    notesInput.value = localStorage.getItem('myNotes_' + page) || "";
    updateIndicator();
  }
  function saveCurrentNotes() {
    localStorage.setItem('myNotes_' + currentPage, notesInput.value);
  }
  loadNotes(currentPage);

  // ================= Chat =================
  function addMessage(content, sender='user') {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', sender === 'ai' ? 'ai-message' : 'user-message');
    msgDiv.innerHTML = content.replace(/\n/g, '<br>');
    conversation.appendChild(msgDiv);
    conversation.scrollTop = conversation.scrollHeight;
  }
  function sendMessage() {
    let text = userInput.value.replace(/\r/g, '').replace(/\u200B/g, '').trim();
    if (!text) return;

    if (welcomeMessage.style.display !== 'none') {
      welcomeMessage.style.display = 'none';
      conversation.style.display = 'flex';
    }

    addMessage(text, 'user');
    userInput.value = '';
    resizeTextarea();
    conversation.style.marginBottom = '160px';
    setTimeout(() => addMessage("This is A.S.T.R.A's response.", 'ai'), 500);
  }

  sendBtn.addEventListener('click', sendMessage);

  // ================= Textarea Handling =================
  function resizeTextarea() {
    const maxHeight = 150;
    userInput.style.height = 'auto';
    const newHeight = Math.min(userInput.scrollHeight, maxHeight);
    userInput.style.height = newHeight + 'px';
    conversation.style.marginBottom = 160 + newHeight - 40 + 'px';
    conversation.scrollTop = conversation.scrollHeight;
  }

  userInput.addEventListener('input', resizeTextarea);
  userInput.addEventListener('focus', () => {
    setTimeout(() => {
      userInput.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      userInput.scrollTop = userInput.scrollHeight;
    }, 300);
  });

  userInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // ================= Dark Mode =================
  const savedMode = localStorage.getItem('chatMode');
  if (savedMode === 'dark') { document.body.classList.add('dark-mode'); darkToggle.textContent = '‚òÄÔ∏è Light Mode'; setPanelsDarkMode(true);}
  else { darkToggle.textContent = 'üåô Dark Mode'; setPanelsDarkMode(false);}
  darkToggle.addEventListener('click', () => {
    const isDark = document.body.classList.toggle('dark-mode');
    darkToggle.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    localStorage.setItem('chatMode', isDark ? 'dark' : 'light');
    setPanelsDarkMode(isDark);
  });
  function setPanelsDarkMode(isDark) {
    [notesPanel, calendarPanel, allEventsPanel].forEach(panel => {
      panel.style.backgroundColor = isDark ? '#1e1e1e' : '#fff';
      panel.style.color = isDark ? '#f5f5f5' : '#000';
      panel.style.border = isDark ? '1px solid #555' : '1px solid #ccc';
    });
  }

  // ================= Options Menu =================
  optionBtn.addEventListener('click', () => {
    optionMenu.style.display = optionMenu.style.display === 'block' ? 'none' : 'block';
  });
  document.addEventListener('click', (e) => {
    if (!optionBtn.contains(e.target) && !optionMenu.contains(e.target)) {
      optionMenu.style.display = 'none';
    }
  });

  // ================= Notes Navigation =================
  notesBtn.addEventListener('click', () => {
    notesPanel.style.display = notesPanel.style.display === 'flex' ? 'none' : 'flex';
    calendarPanel.style.display = 'none';
    allEventsPanel.style.display = 'none';
    optionMenu.style.display = 'none';
  });
  closeNotes.addEventListener('click', () => notesPanel.style.display = 'none');
  saveNotes.addEventListener('click', () => { saveCurrentNotes(); alert("‚úÖ Notes saved!"); });
  nextNotes.addEventListener('click', () => { if(currentPage < totalPages-1){ saveCurrentNotes(); currentPage++; loadNotes(currentPage);} else {alert("‚ö†Ô∏è Last page!");}});
  backNotes.addEventListener('click', () => { if(currentPage>0){ saveCurrentNotes(); currentPage--; loadNotes(currentPage);} else{alert("‚ö†Ô∏è First page!");}});

  // ================= Notes Fullscreen =================
  let isFullScreen = false;
  const originalNotesStyles = { width: notesPanel.style.width, height: notesPanel.style.height, top: notesPanel.style.top, left: notesPanel.style.left, position: notesPanel.style.position };
  fullScreenNotesBtn.addEventListener('click', () => {
    if(!isFullScreen){
      notesPanel.style.position='fixed'; notesPanel.style.width='60%'; notesPanel.style.height='60%';
      notesPanel.style.top='20%'; notesPanel.style.left='20%'; notesPanel.style.zIndex='1000'; notesPanel.style.flexDirection='column';
      isFullScreen = true;
    } else {
      notesPanel.style.position=originalNotesStyles.position;
      notesPanel.style.width=originalNotesStyles.width;
      notesPanel.style.height=originalNotesStyles.height;
      notesPanel.style.top=originalNotesStyles.top;
      notesPanel.style.left=originalNotesStyles.left;
      isFullScreen = false;
    }
  });

  // ================= Calendar =================
  let currentDate = new Date();
  let calendarEvents = JSON.parse(localStorage.getItem('calendarEvents')) || [];
  let selectedDay = null;

  function saveEvents() { localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents)); }

  function renderCalendar() {
    calendarGrid.innerHTML = '';
    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{const hd=document.createElement('div'); hd.textContent=d; hd.style.fontWeight='bold'; hd.style.textAlign='center'; hd.style.padding='6px 0'; calendarGrid.appendChild(hd);});
    const year=currentDate.getFullYear(), month=currentDate.getMonth();
    monthYearLabel.textContent=`${currentDate.toLocaleString('default',{month:'long'})} ${year}`;
    const firstDay=new Date(year,month,1).getDay();
    const daysInMonth=new Date(year,month+1,0).getDate();
    for(let i=0;i<firstDay;i++) calendarGrid.appendChild(document.createElement('div'));
    for(let day=1;day<=daysInMonth;day++){
      const dayDiv=document.createElement('div'); dayDiv.textContent=day; dayDiv.style.padding='6px'; dayDiv.style.border='1px solid #ccc';
      dayDiv.style.textAlign='center'; dayDiv.style.cursor='pointer';
      const dayKey=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      if(calendarEvents.filter(e=>e.date===dayKey).length>0){ dayDiv.style.fontWeight='bold'; dayDiv.title=calendarEvents.filter(e=>e.date===dayKey).map(e=>e.text).join('\n');}
      if(selectedDay===day){dayDiv.style.background='#4CAF50'; dayDiv.style.color='white';}
      const today=new Date(); if(day===today.getDate()&&month===today.getMonth()&&year===today.getFullYear()){dayDiv.style.fontWeight='bold'; dayDiv.style.backgroundColor='#fff'; dayDiv.style.color='#000'; dayDiv.style.borderRadius='50%';}
      dayDiv.addEventListener('click',()=>{selectedDay=day; renderCalendar();});
      calendarGrid.appendChild(dayDiv);
    }
  }

  prevMonthBtn.addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()-1); selectedDay=null; renderCalendar();});
  nextMonthBtn.addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()+1); selectedDay=null; renderCalendar();});
  addCalendarEventBtn.addEventListener('click',()=>{
    if(!selectedDay || !eventTextInput.value.trim()){alert('Please select a day and enter event text.'); return;}
    const dateKey=`${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}-${String(selectedDay).padStart(2,'0')}`;
    calendarEvents.push({date:dateKey,text:eventTextInput.value.trim()});
    saveEvents(); eventTextInput.value=''; renderCalendar();
  });

  calendarBtn.addEventListener('click',()=>{calendarPanel.style.display=calendarPanel.style.display==='flex'?'none':'flex'; notesPanel.style.display='none'; allEventsPanel.style.display='none'; optionMenu.style.display='none';});
  closeCalendar.addEventListener('click',()=>calendarPanel.style.display='none');
  setInterval(()=>{const now=new Date(); if(now.getDate()!==currentDate.getDate()||now.getMonth()!==currentDate.getMonth()||now.getFullYear()!==currentDate.getFullYear()){currentDate=now; selectedDay=null; renderCalendar();}},60000);

  // ================= View All Events =================
  viewEventsBtn.addEventListener('click',()=>{
    calendarPanel.style.display='none'; notesPanel.style.display='none'; allEventsPanel.style.display='flex'; optionMenu.style.display='none'; renderAllEvents();
  });
  closeEvents.addEventListener('click',()=>allEventsPanel.style.display='none');
  function renderAllEvents(){
    eventsList.innerHTML='';
    if(calendarEvents.length===0){ eventsList.textContent='No events set.'; return;}
    calendarEvents.slice().sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach((ev,index)=>{
      const evDiv=document.createElement('div');
      evDiv.style.display='flex'; evDiv.style.justifyContent='space-between'; evDiv.style.alignItems='center';
      evDiv.style.border='1px solid #ccc'; evDiv.style.borderRadius='6px'; evDiv.style.padding='5px 8px';
      evDiv.style.background=document.body.classList.contains('dark-mode')?'#333':'#f5f5f5';
      evDiv.style.color=document.body.classList.contains('dark-mode')?'#fff':'#000'; evDiv.style.marginBottom='5px';
      const textSpan=document.createElement('span'); textSpan.textContent=`${ev.date} ‚Üí ${ev.text}`;
      const deleteBtn=document.createElement('button'); deleteBtn.textContent='‚ùå'; deleteBtn.style.background='none';
      deleteBtn.style.border='none'; deleteBtn.style.cursor='pointer'; deleteBtn.style.fontSize='14px'; deleteBtn.style.color='#ff4d4d';
      deleteBtn.addEventListener('click',()=>{ if(confirm('Are you sure you want to delete this event?')){ calendarEvents.splice(index,1); saveEvents(); renderAllEvents(); renderCalendar(); }});
      evDiv.appendChild(textSpan); evDiv.appendChild(deleteBtn); eventsList.appendChild(evDiv);
    });
  }

  renderCalendar();
  resizeTextarea();
});

document.addEventListener('DOMContentLoaded', () => {
  const conversation = document.getElementById('conversation');
  const userInput = document.getElementById('user-input');

  // ================= Mobile viewport fix =================
  function setViewportHeight() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  setViewportHeight();
  window.addEventListener('resize', setViewportHeight);
  window.addEventListener('orientationchange', setViewportHeight);

  // ================= Prevent body scroll except chat/input =================
  document.body.addEventListener('touchmove', function(e){
    if(e.target.closest('#conversation') || e.target.closest('#user-input')) return;
    e.preventDefault();
  }, { passive: false });

  // ================= Mobile keyboard scroll fix =================
  function scrollConversationToBottom() {
    setTimeout(() => {
      conversation.scrollTop = conversation.scrollHeight;
    }, 300);
  }

  userInput.addEventListener('focus', scrollConversationToBottom);
  userInput.addEventListener('input', scrollConversationToBottom);
  window.addEventListener('resize', () => {
    if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
      scrollConversationToBottom();
    }
  });

  // ================= Auto-resize + scroll fix para sa input bar =================
  const maxInputHeight = 150; // maximum height ng textarea

  function resizeUserInput() {
    userInput.style.height = 'auto';
    const newHeight = Math.min(userInput.scrollHeight, maxInputHeight);
    userInput.style.height = newHeight + 'px';

    // Scroll sa bottom kapag lumagpas sa maxHeight
    if(userInput.scrollHeight > maxInputHeight) {
      userInput.scrollTop = userInput.scrollHeight;
    }
  }

  userInput.addEventListener('input', resizeUserInput);
  userInput.addEventListener('focus', () => setTimeout(resizeUserInput, 300));
  window.addEventListener('resize', resizeUserInput);

  // Initial resize
  resizeUserInput();
});
</script>